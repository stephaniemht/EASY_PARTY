<div class="container">
  <h1><%= @event.name %></h1>
  <p>Lieu : <%= @event.address %></p>
  <p>Description : <%= @event.description %></p>

  <% if policy(@event).edit? %>
    <%= link_to 'Modifier', edit_event_path(@event), class: 'btn btn-primary' %>
  <% end %>

  <%= link_to 'Supprimer', event_path(@event), data: { turbo_method: :delete, turbo_confirm: 'Etes vous s√ªr ?' }, class: 'btn btn-danger' if policy(@event).destroy? %>
  <%= link_to 'Retour √† la liste', events_path, class: 'btn btn-primary' %>

 
  <h2>Dates propos√©es</h2>
  <% if @event.event_dates.any? %>
    <ul>
      <% @event.event_dates.each do |event_date| %>
        <li>
          <p><strong>Date :</strong> <%= l(event_date.proposed_date, format: :long) %></p>
          <p><strong>Votes :</strong> <%= event_date.votes.count %></p>

          <% if event_date.votes.where(user: current_user).empty? %>
            <%= button_to "Voter pour cette date", votes_path(event_date_id: event_date.id),
                          method: :post,
                          class: "btn btn-primary" %>
          <% else %>
            <p class="text-success">Vous avez d√©j√† vot√© pour cette date.</p>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p>Aucune date n'a √©t√© propos√©e pour cet √©v√©nement.</p>
  <% end %>


  <% if @event.album.present? %>
    <h2>Album de l'√©v√®nement</h2>
    <%= link_to "Voir l'Album", event_album_path(@event, @event.album), class: 'btn btn-primary' %>
  <% else %>
    <p>Aucun album n'a √©t√© cr√©√© pour cet √©v√®nement.</p>
  <% end %>


  <% if @event.jackpot %>
    <h2>Cagnotte</h2>
    <p>L'organisateur se charge des courses, bande de fain√©ant ü¶•</p>
    <p><strong>Montant demand√© par personne :</strong> <%= @event.jackpot.amount_per_person %> ‚Ç¨</p>
    <p><strong>Total attendu :</strong> <%= @event.jackpot.amount_per_person * @event.jackpot.total_invitees %> ‚Ç¨</p>
    <p><strong>Montant collect√© :</strong> <%= @event.jackpot.total %> ‚Ç¨</p>
    <p><%= link_to 'Voir les participants', event_jackpot_path(@event, @event.jackpot), class: "btn btn-primary" %></p>

    <% if @event.jackpot %>
      <p>
        <%= link_to "Tu as pay√© ?", monney_creation_path(@event.jackpot),
                    data: { turbo_method: :post, turbo_confirm: "Envoie la preuve ! Mito" },
                    class: 'btn btn-primary',
                    disabled: true %>
      </p>
    <% end %>
  <% else %>
    <h2>Votre liste de courses</h2>
      <%= turbo_frame_tag "items_frame" do %>
        <% if @event.items.present? %>
          <%= render partial: "items/list", locals: { items: @event.items } %>
        <% else %>
          <%= turbo_frame_tag "item_form" do %>
            <%= link_to "Ajouter un item", new_event_item_path(@event),
                        class: "btn btn-primary",
                        data: { turbo_frame: "item_form" } %>
          <% end %>
        <% end %>
      <% end %>
  <% end %>
</div>
